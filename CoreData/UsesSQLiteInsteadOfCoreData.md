一个完整的 Core Data 应用 <sup>[1]</sup>
====

__我找不到一个好理由在说服你不去使用 Core Data，它实在是太优秀了，目前被大量的 Cocoa 开发者使用，这样当你的小组有新成员加入时，或者有别人要接替你的工作时，开发维护工作会变得非常顺利。__

__更重要的是，没有必要花时间或精力去开发一个你自己的数据系统，总之享受 Core Data 吧。__

为什么我不用 Core Data
===

[Mike Ash 说](http://www.mikeash.com/pyblog/friday-qa-2013-08-30-model-serialization-with-property-lists.html)：

> 从个人角度上讲，我不是特别喜欢 Core Data，它的 API 有些笨重，类库本身呢又显得比较慢，尤其是对一些数据量较大的应用来说。

一个现实的栗子：10000 条数据
---

比如说我现在有一个 RSS 阅读器，用户可以右键单击某一个订阅源，然后把这个订阅源下所有的条目标记为已读。

这种情况下，会有一个有 read 属性的 Article 实体，为了把每一个条目标记为已读，应用需要把这个订阅源下所有的文章都载入到内存中，然后把 read 属性设置为 YES。

通常情况下，上面的处理的方法还说得过去，但是假设这个订阅源下面有200篇文章，你就要考虑把这项工作放在后台进行以免阻塞了主线程了（尤其是在 iPhone 应用中），这样你就必须考虑多线程的 Core Data，事情变得麻烦了起来。

看起来可能还不至于因为这点儿事儿就弃用了 Core Data，那么在考虑一下下面的情况呢？

RSS 订阅源是需要同步的，我现在有两种不同的 RSS 同步 API，他们都返回一个已读文章的 ID 数组，其中一个可能会返回多达 10000 个 ID。你不想把这 10000 篇文章都载入到内存然后在主线程里把它们的 read 属性设为 NO；你也不想在后台线程中这样做：因为无论任何一种做法都会耗费太大代价（比如电池负荷）。

实际上一个比较好的解决办法是：告诉数据库把数组中的每一篇文章的 read 属性设为 NO。SQLite 就可以做到这一点，而且只需要一步操作。如果你又在表的 uniqueID 字段建立了索引，那么这个操作时很快的，你也可以像在主线程一个轻松的完成这一任务。

另外一个栗子：快速启动
---

我还有一个应用，我想降低它的启动时间——不仅仅是进入应用的时间，还有数据完全被显示出来的时间。

比如 Twitter：它会显示出来一个时间线。如果想达到这样的效果的话，需要从服务器下载信息，然后把与用户相关的信息显示出来。这个过程很快，但是在启动时，仍然是先显示 UI 界面，然后再填充数据。

我认为一个 iPhone 应用的启动时间关系到用户是否愿意用它，启动时间长意味着用户可能会变得不是特别喜欢它，因为用户会下意识的对这种慢的应用产生抵触情绪。因此，加快启动速度能一定程度上让用户更愿意打开它，也更愿意把它推荐给周围的人，这是你的应用成功的一部分。

为了加快启动速度，我放弃了使用 Core Data，而换了一种古老的解决方法。我把时间线信息通过 NSCoding 保存到 plist 文件中，在启动时，应用读取 plist 文件，创建信息并在 UI 出现的时候把它展示出来。

这能很大程度上的减少启动时间。

但如果把这些信息作为 NSManagedObject 对象保存起来的话，上述目标就变得不可能了。

我是怎么看 Core Data 的
---

当我决定是不是要使用 Core Data 时，我会考虑一些事情。

###数据量会很大吗？###

如果是一个 RSS 阅读器，或者是一个类似于 Twitter 的应用，数据量当然后很大，可能有的用户会粉上百个人，也可能有用户会订阅上千个订阅源。

即使你的应用不从网络上获取数据，用户仍然可能会自动添加数据。如果你开发一个 Mac 版本的应用，有些用户可能会用它产生大量的数据；如果它还有的联网的 API的话，也是一样的。

###会有一个返回一些类似于数据库结果（反之是类似于对象结构的结果）的联网 API 吗？###

一个 RSS 同步的 API 可能会返回一个已读文章的唯一 ID 列表；一个提醒应用也可能有一个同步 API，返回已经归档的或者已删除的备忘的唯一 ID 列表。

###用户可能做一些处理大量数据的动作吗？###

在这种情况下，和之前的考虑是一样的。当用户用你的应用一下删除了 5000 条数据，你的应用表现的如何呢？

如果我决定使用 Core Data —— 实际上我也发布过 Core Data 应用 —— 我会十分注意我将如何使用它。如果为了提高效率，而我又使用了 Core Data 作为数据库接口的话，我会毫不犹豫的放弃它，转用 SQLite。

本话题的更多文章
---
* [Core Data概述](CoreDataOverview.md)
* [一个简单却完整的 Core Data 应用](SimpleButCompleteCoreDataApplication.md)
* [Data Model 和 Model Objects](DataModelsAndModelObjects.md)
* [导入大量数据]()
* [查询](PerformantFetching.md)
* [自定义 Core Data 的数据迁移](CustomCoreDataMigrations.md)

备注
---
[1] 原文链接：http://www.objc.io/issue-4/SQLite-instead-of-core-data.html 
[2] 由于我没有实践过 FMDB 方面的编程，文中关于 FMDB 的相关段落翻译可能会不尽准确，请见谅。有兴趣的可以移步原文。
